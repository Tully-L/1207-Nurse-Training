<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>杏林暖芯 - 智慧护理培训平台</title>
    <style>
        /* 全局样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft Yahei", sans-serif;
            line-height: 1.6;
            color: #333;
            /* 确保页面可滚动 */
            overflow-y: auto;
        }

        /* 顶部导航栏样式 */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c7fb8;
        }

        .nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav a {
            text-decoration: none;
            color: #333;
            font-size: 1rem;
        }

        .nav a:hover {
            color: #2c7fb8;
        }

        .contact-btn {
            padding: 0.5rem 1rem;
            background-color: #2c7fb8;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .contact-btn:hover {
            background-color: #1f6aa5;
        }

        /* SP内容区域样式 - 左对齐，占页面左侧60% */
        .sp {
            width: 60%;
            margin: 2rem 0 2rem 2rem;
            /* 左对齐，距离左侧2rem，上下有间距 */
            padding: 0 2rem;
            /* 内边距，避免文字贴边 */
            text-align: left;
            /* 强制左对齐 */
        }

        /* 标题样式优化 */
        .sp h1 {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: #2c7fb8;
        }

        .sp h2 {
            font-size: 1.5rem;
            margin: 1.2rem 0 0.8rem;
            color: #333;
        }

        .sp h3 {
            font-size: 1.2rem;
            margin: 1rem 0 0.6rem;
            color: #444;
        }

        /* 列表和段落样式 */
        .sp p,
        .sp ul {
            margin-bottom: 1rem;
            font-size: 1rem;
        }

        .sp ul {
            padding-left: 1.5rem;
            /* 列表缩进 */
        }

        .sp li {
            margin-bottom: 0.5rem;
        }

        .sp strong {
            color: #2c7fb8;
        }

        /* 资源列表样式 */
        .resource-list {
            list-style-type: decimal;
            padding-left: 2rem;
        }

        .resource-list li {
            margin-bottom: 1.5rem;
            line-height: 1.8;
            position: relative;
        }

        .resource-list a {
            color: #2c7fb8;
            text-decoration: none;
            font-weight: 500;
        }

        .resource-list a:hover {
            text-decoration: underline;
        }

        .resource-title {
            font-weight: bold;
            color: #333;
            display: block;
            margin-bottom: 0.3rem;
        }

        /* 搜索和编辑功能样式 */
        .controls-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .search-box {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .search-box input {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            width: 300px;
        }

        .search-box button {
            padding: 0.5rem 1rem;
            background-color: #2c7fb8;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .search-box button:hover {
            background-color: #1f6aa5;
        }

        .edit-btn {
            padding: 0.5rem 1rem;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .edit-btn:hover {
            background-color: #218838;
        }

        /* 弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .modal-content input,
        .modal-content textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .modal-content textarea {
            height: 80px;
            resize: vertical;
        }

        .modal-buttons {
            text-align: center;
        }

        .modal-buttons button {
            margin: 0 10px;
            padding: 8px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .modal-buttons button:first-child {
            background: #28a745;
            color: white;
        }

        .modal-buttons button:last-child {
            background: #6c757d;
            color: white;
        }

        /* 编辑模式样式 */
        .edit-mode .resource-list li {
            border: 2px dashed transparent;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .edit-mode .resource-list li:hover {
            border-color: #28a745;
            background-color: rgba(40, 167, 69, 0.1);
        }

        .edit-controls {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .edit-controls button {
            margin: 0 5px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .add-btn {
            background: #007bff;
            color: white;
        }

        .save-btn {
            background: #28a745;
            color: white;
        }

        .cancel-btn {
            background: #dc3545;
            color: white;
        }

        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 12px;
            display: none;
        }

        .edit-mode .delete-btn {
            display: block;
        }

        /* 搜索高亮 */
        .highlight {
            background-color: yellow;
            font-weight: bold;
        }

        /* 无搜索结果提示 */
        .no-results {
            text-align: center;
            color: #666;
            font-style: italic;
            margin: 2rem 0;
            display: none;
        }
    </style>
</head>

<body>
    <!-- 1. 引入 Coze 官方 SDK（测试版） -->
    <script src="https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/1.2.0-beta.19/libs/cn/index.js"></script>

    <!-- 2. 引入自定义 SDK 配置 -->
    <script src="./index.js"></script>

    <!-- 顶部导航栏 -->
    <header class="header">
        <div class="logo">杏林暖蕊</div>
        <nav class="nav">
            <a href="index.html">首页</a>
            <a href="about.html">关于我们</a>
            <a href="#">SP资源库</a>
            <button class="contact-btn">联系我们</button>
        </nav>
    </header>

    <!-- 资源库内容区域 -->
    <div class="sp">
     

        <!-- 控制栏：搜索和编辑 -->
        <div class="controls-bar">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="搜索资料标题或链接...">
                <button onclick="searchResources()">搜索</button>
                <button onclick="clearSearch()">清除</button>
            </div>
            <button id="editBtn" class="edit-btn" onclick="showPasswordModal()">管理资料</button>
        </div>
        <p>
            < 右下角按钮"科研探索"">
        </p>
        <h2>相关课程资料</h2>

        <!-- 无搜索结果提示 -->
        <div class="no-results" id="noResults">
            未找到匹配的资料，请尝试其他关键词。
        </div>

        <ol class="resource-list" id="resourceList">
            <li data-id="1">
                <button class="delete-btn" onclick="deleteResource(this)">×</button>
                <span class="resource-title">急危重症阶段考核评分表 3.pdf</span>
                链接：<a
                    href="https://mcn5mky7x3o0.feishu.cn/wiki/WbHzw8DLJizfoHkEfJwcCNhQnjc?larkTabName=space#share-OMe6dL4NkoKXzqxYGdUcGec7nZd"
                    target="_blank">查看文档</a>
            </li>
            <li data-id="2">
                <button class="delete-btn" onclick="deleteResource(this)">×</button>
                <span class="resource-title">静脉留置针输液技术演示视频.mp4</span>
                链接：<a
                    href="https://mcn5mky7x3o0.feishu.cn/wiki/WbHzw8DLJizfoHkEfJwcCNhQnjc?larkTabName=space#share-XegTdFySPo1YOgxKhTwcsC79nFg"
                    target="_blank">观看视频</a>
            </li>
            <li data-id="3">
                <button class="delete-btn" onclick="deleteResource(this)">×</button>
                <span class="resource-title">静脉输液穿刺操作课件（八定）(1)(1).pptx</span>
                链接：<a
                    href="https://mcn5mky7x3o0.feishu.cn/wiki/WbHzw8DLJizfoHkEfJwcCNhQnjc?larkTabName=space#share-QjV0d1ZA9oQk7Ix8HcvcJxRFnrP"
                    target="_blank">查看课件</a>
            </li>
            <li data-id="4">
                <button class="delete-btn" onclick="deleteResource(this)">×</button>
                <span class="resource-title">静脉输液穿刺操作课件.pptx</span>
                链接：<a
                    href="https://mcn5mky7x3o0.feishu.cn/wiki/WbHzw8DLJizfoHkEfJwcCNhQnjc?larkTabName=space#share-ARpSdjcvmoyK5Nx0yi3csOBCnPd"
                    target="_blank">查看课件</a>
            </li>
            <li data-id="5">
                <button class="delete-btn" onclick="deleteResource(this)">×</button>
                <span class="resource-title">静脉输液故障的识别与排除(1).pdf</span>
                链接：<a
                    href="https://mcn5mky7x3o0.feishu.cn/wiki/WbHzw8DLJizfoHkEfJwcCNhQnjc?larkTabName=space#share-Puk7dXKyBoOBgBxi0skc3cVAnhd"
                    target="_blank">查看文档</a>
            </li>
            <li data-id="6">
                <button class="delete-btn" onclick="deleteResource(this)">×</button>
                <span class="resource-title">静脉输液皮肤消毒7.7.pptx</span>
                链接：<a
                    href="https://mcn5mky7x3o0.feishu.cn/wiki/WbHzw8DLJizfoHkEfJwcCNhQnjc?larkTabName=space#share-Hl05dgkSdoaXEex9DKsc1tfFnQe"
                    target="_blank">查看课件</a>
            </li>
            <li data-id="7">
                <button class="delete-btn" onclick="deleteResource(this)">×</button>
                <span class="resource-title">密闭式周围静脉输液法（头皮针）口述(1).docx</span>
                链接：<a
                    href="https://mcn5mky7x3o0.feishu.cn/wiki/WbHzw8DLJizfoHkEfJwcCNhQnjc?larkTabName=space#share-ZtaRdiUo2oZOcpxJgTccfcNhn2f"
                    target="_blank">查看文档</a>
            </li>
        </ol>
    </div>

    <!-- 密码输入弹窗 -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <h3>请输入管理密码</h3>
            <input type="password" id="passwordInput" placeholder="请输入密码">
            <div class="modal-buttons">
                <button onclick="checkPassword()">确认</button>
                <button onclick="closePasswordModal()">取消</button>
            </div>
        </div>
    </div>

    <!-- 添加/编辑资料弹窗 -->
    <div id="resourceModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">添加新资料</h3>
            <input type="text" id="resourceTitle" placeholder="资料标题">
            <input type="url" id="resourceUrl" placeholder="资料链接">
            <textarea id="resourceDesc" placeholder="资料描述（可选）"></textarea>
            <div class="modal-buttons">
                <button onclick="saveResource()">保存</button>
                <button onclick="closeResourceModal()">取消</button>
            </div>
        </div>
    </div>

    <!-- 编辑控制按钮 -->
    <div class="edit-controls" id="editControls">
        <button class="add-btn" onclick="showAddResourceModal()">添加资料</button>
        <button class="save-btn" onclick="saveAllChanges()">保存所有更改</button>
        <button class="cancel-btn" onclick="exitEditMode()">退出编辑</button>
    </div>
</body>

<script>
    let isEditMode = false;
    let originalResources = [];
    let currentEditingId = null;
    let nextId = 8; // 下一个资源ID

    // 搜索功能
    function searchResources() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
        const resourceItems = document.querySelectorAll('#resourceList li');
        const noResults = document.getElementById('noResults');
        let hasResults = false;

        // 清除之前的高亮
        clearHighlight();

        if (searchTerm === '') {
            // 如果搜索框为空，显示所有资源
            resourceItems.forEach(item => {
                item.style.display = 'list-item';
            });
            noResults.style.display = 'none';
            return;
        }

        resourceItems.forEach(item => {
            const title = item.querySelector('.resource-title').textContent.toLowerCase();
            const link = item.querySelector('a').href.toLowerCase();

            if (title.includes(searchTerm) || link.includes(searchTerm)) {
                item.style.display = 'list-item';
                hasResults = true;

                // 高亮匹配的文本
                highlightText(item.querySelector('.resource-title'), searchTerm);
            } else {
                item.style.display = 'none';
            }
        });

        noResults.style.display = hasResults ? 'none' : 'block';
    }

    // 清除搜索
    function clearSearch() {
        document.getElementById('searchInput').value = '';
        const resourceItems = document.querySelectorAll('#resourceList li');
        const noResults = document.getElementById('noResults');

        resourceItems.forEach(item => {
            item.style.display = 'list-item';
        });
        noResults.style.display = 'none';
        clearHighlight();
    }

    // 高亮文本
    function highlightText(element, searchTerm) {
        const text = element.textContent;
        const regex = new RegExp(`(${searchTerm})`, 'gi');
        const highlightedText = text.replace(regex, '<span class="highlight">$1</span>');
        element.innerHTML = highlightedText;
    }

    // 清除高亮
    function clearHighlight() {
        const highlighted = document.querySelectorAll('.highlight');
        highlighted.forEach(span => {
            const parent = span.parentNode;
            parent.replaceChild(document.createTextNode(span.textContent), span);
            parent.normalize();
        });
    }

    // 显示密码弹窗
    function showPasswordModal() {
        document.getElementById('passwordModal').style.display = 'block';
    }

    // 关闭密码弹窗
    function closePasswordModal() {
        document.getElementById('passwordModal').style.display = 'none';
        document.getElementById('passwordInput').value = '';
    }

    // 验证密码
    function checkPassword() {
        const password = document.getElementById('passwordInput').value;
        if (password === '20251226') {
            closePasswordModal();
            enterEditMode();
        } else {
            alert('密码错误！');
            document.getElementById('passwordInput').value = '';
        }
    }

    // 进入编辑模式
    function enterEditMode() {
        isEditMode = true;
        document.body.classList.add('edit-mode');
        document.getElementById('editControls').style.display = 'block';
        document.getElementById('editBtn').style.display = 'none';

        // 保存原始数据
        saveOriginalData();

        // 重新编号列表项
        renumberList();
    }

    // 保存原始数据
    function saveOriginalData() {
        const resourceItems = document.querySelectorAll('#resourceList li');
        originalResources = [];

        resourceItems.forEach(item => {
            const title = item.querySelector('.resource-title').textContent;
            const link = item.querySelector('a').href;
            const linkText = item.querySelector('a').textContent;
            const id = item.getAttribute('data-id');

            originalResources.push({
                id: id,
                title: title,
                link: link,
                linkText: linkText
            });
        });
    }

    // 显示添加资料弹窗
    function showAddResourceModal() {
        currentEditingId = null;
        document.getElementById('modalTitle').textContent = '添加新资料';
        document.getElementById('resourceTitle').value = '';
        document.getElementById('resourceUrl').value = '';
        document.getElementById('resourceDesc').value = '';
        document.getElementById('resourceModal').style.display = 'block';
    }

    // 关闭资料弹窗
    function closeResourceModal() {
        document.getElementById('resourceModal').style.display = 'none';
        currentEditingId = null;
    }

    // 保存资料
    function saveResource() {
        const title = document.getElementById('resourceTitle').value.trim();
        const url = document.getElementById('resourceUrl').value.trim();
        const desc = document.getElementById('resourceDesc').value.trim();

        if (!title || !url) {
            alert('请填写资料标题和链接！');
            return;
        }

        if (currentEditingId) {
            // 编辑现有资料
            const item = document.querySelector(`[data-id="${currentEditingId}"]`);
            item.querySelector('.resource-title').textContent = title;
            item.querySelector('a').href = url;
            item.querySelector('a').textContent = desc || '查看资料';
        } else {
            // 添加新资料
            const resourceList = document.getElementById('resourceList');
            const newItem = document.createElement('li');
            newItem.setAttribute('data-id', nextId++);

            newItem.innerHTML = `
                <button class="delete-btn" onclick="deleteResource(this)">×</button>
                <span class="resource-title">${title}</span>
                链接：<a href="${url}" target="_blank">${desc || '查看资料'}</a>
            `;

            resourceList.appendChild(newItem);
        }

        closeResourceModal();
        renumberList();
    }

    // 删除资料
    function deleteResource(button) {
        if (confirm('确定要删除这个资料吗？')) {
            const item = button.parentElement;
            item.remove();
            renumberList();
        }
    }

    // 重新编号列表
    function renumberList() {
        const resourceItems = document.querySelectorAll('#resourceList li');
        resourceItems.forEach((item, index) => {
            // 由于使用了CSS counter，这里不需要手动设置编号
            // CSS会自动处理编号
        });
    }

    // 保存所有更改
    function saveAllChanges() {
        if (confirm('确定要保存所有更改吗？')) {
            // 这里可以添加保存到服务器的逻辑
            // 目前保存到本地存储
            const currentResources = [];
            const resourceItems = document.querySelectorAll('#resourceList li');

            resourceItems.forEach(item => {
                const title = item.querySelector('.resource-title').textContent;
                const link = item.querySelector('a').href;
                const linkText = item.querySelector('a').textContent;
                const id = item.getAttribute('data-id');

                currentResources.push({
                    id: id,
                    title: title,
                    link: link,
                    linkText: linkText
                });
            });

            localStorage.setItem('nursingResources', JSON.stringify(currentResources));
            exitEditMode();
            alert('保存成功！');
        }
    }

    // 退出编辑模式
    function exitEditMode() {
        isEditMode = false;
        document.body.classList.remove('edit-mode');
        document.getElementById('editControls').style.display = 'none';
        document.getElementById('editBtn').style.display = 'block';
        closeResourceModal();
    }

    // 页面加载时恢复保存的数据
    window.addEventListener('load', function () {
        const savedResources = localStorage.getItem('nursingResources');
        if (savedResources) {
            const resources = JSON.parse(savedResources);
            const resourceList = document.getElementById('resourceList');

            // 清空现有列表
            resourceList.innerHTML = '';

            // 重建列表
            resources.forEach(resource => {
                const newItem = document.createElement('li');
                newItem.setAttribute('data-id', resource.id);

                newItem.innerHTML = `
                    <button class="delete-btn" onclick="deleteResource(this)">×</button>
                    <span class="resource-title">${resource.title}</span>
                    链接：<a href="${resource.link}" target="_blank">${resource.linkText}</a>
                `;

                resourceList.appendChild(newItem);
            });

            // 更新下一个ID
            if (resources.length > 0) {
                nextId = Math.max(...resources.map(r => parseInt(r.id))) + 1;
            }
        }
    });

    // 搜索框回车事件
    document.getElementById('searchInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            searchResources();
        }
    });

    // 密码框回车事件
    document.getElementById('passwordInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            checkPassword();
        }
    });

    // 点击弹窗外部关闭
    window.addEventListener('click', function (e) {
        const passwordModal = document.getElementById('passwordModal');
        const resourceModal = document.getElementById('resourceModal');

        if (e.target === passwordModal) {
            closePasswordModal();
        }
        if (e.target === resourceModal) {
            closeResourceModal();
        }
    });

    // 键盘快捷键
    document.addEventListener('keydown', function (e) {
        if (isEditMode) {
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveAllChanges();
            }
            if (e.key === 'Escape') {
                exitEditMode();
            }
        }

        // 搜索快捷键 Ctrl+F
        if (e.ctrlKey && e.key === 'f') {
            e.preventDefault();
            document.getElementById('searchInput').focus();
        }
    });
</script>

</html>